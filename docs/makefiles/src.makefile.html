<p>-e </p>
<h1 id="src-makefile-md">src.makefile.md</h1>
<p><code>src.makefile</code> </p>
<h3 id="js-source-code-management-">JS Source Code Management.</h3>
<p>Manages bundle builds for javascript files. </p>
<p>run <code>make help</code> see top level non-pattern rules<br>run <code>make</code> development<br>run <code>make PRODUCTION=1</code> production production mode (minified) aka NODE_ENV=production  </p>
<p><code>common.makefile</code> </p>
<h3 id="common-makefile-library">Common Makefile Library</h3>
<p>Base makefile library<br>This is included from a top level makefile.  </p>
<p><code>js.makefile</code> </p>
<h3 id="java-script-transpile-makefile-compiles-js-sources-through-chain-of-linting-transpiling-bundling-minifing-and-zipping-">Java Script Transpile Makefile Compiles .js sources through chain of linting, transpiling, bundling, minifing, and zipping.</h3>
<p>run <code>make -f PROJECT_ROOT/makefiles-for-js/makefiles/js.makefile -p</code> to print out rules of the js makefile<br>-e </p>
<h1 id="targets">TARGETS</h1>
<p>.DEFAULT_GOAL = all </p>
<p><code>common.makefile</code> </p>
<p><strong>help</strong>: print this message </p>
<p><strong>printall</strong>: print all public type variables (no underscore; defined in file or command line or environment override) </p>
<p><strong>printall-raw</strong>: print all variables and values known to make </p>
<p><strong>print-%</strong>: print-varname - prints the value of varname </p>
<p><strong>help-use</strong>: print USE_VARNAME type help </p>
<p><strong>help-file</strong>: print help for makefile </p>
<p><strong>help-extra</strong>: print extra help </p>
<p><code>js.makefile</code> </p>
<p><strong>phobia-cdn</strong>: Show how much space you are saving in excluded libs </p>
<p><strong>list-deps</strong>: Show local dependencies. </p>
<p><strong>phobia-deps</strong>: List package dependencies from bundle-phobia.<br>     &quot;sudo npm i -g bundle-phobia&quot; </p>
<p><strong>dot-graph</strong>: Create a dependency graph of targets.<br>    needs makefile2graph <a href="https://github.com/lindenb/makefile2graph">https://github.com/lindenb/makefile2graph</a>) </p>
<p><code>src.makefile</code> </p>
<p><strong>all</strong>: Make the <code>TARGETS</code>. </p>
<p><strong>clean</strong>: Remove <code>TARGETS</code> and <code>DIR_BUILD</code>.<br>-e </p>
<h1 id="use-variables">USE VARIABLES</h1>
<p><code>common.makefile</code> </p>
<p><em>Because of technically difficulity in mdless: USE MDLESS should be USE_MDLESS and so on.</em><br><strong>USE MDLESS</strong>: use <a href="https://github.com/ttscoff/mdless">mdless</a> command to form command line markdown output<br><strong>USE COLOR</strong>: colorize output </p>
<p><code>js.makefile</code> </p>
<p><strong>USE PRODUCTION</strong>: If set then use production options instead of development.<br>    Also will be set if NODE_ENV=production in the environment. </p>
<p><strong>USE BABEL</strong>: transpile with babel </p>
<p><strong>USE LINTER</strong>: use eslint </p>
<p><strong>USE SOURCEMAPS</strong>: bundle source maps for debugging </p>
<p><strong>USE REACT</strong>: set transform flags for react </p>
<p><strong>POST US6</strong>: babel transform for static class props and object spreads<br>-e </p>
<h1 id="extra-help">EXTRA HELP</h1>
<p><code>common.makefile</code> </p>
<p>run <code>make help</code> see top level non-pattern rules<br>run <code>make help-file</code> help for each included file<br>run <code>make help-use</code> help for USE_\% type variables<br>run <code>make -j 8</code> to run with 8 threads in paralell (set the number to number of cores)!<br>run <code>make -n</code> for a dry run that will print out the actually commands it would have used<br>run <code>make --trace</code> to see all recipe shell commands<br>run <code>make --debug=b</code> basic debug dependency chain </p>
<h4 id="dont-set-bool-type-variables-to-zero-">Dont set bool type variables to zero.</h4>
<p>BAD: <code>USE_THINGY :=0</code><br>GOOD: <code>USE_THINGY :=</code><br>This is because make usually checks for existance of variable being set. </p>
<h4 id="watch-out-with-spaces-when-setting-variables-">Watch out with spaces when setting variables.</h4>
<p>Make is very literal in setting things.<br>BAD: <code>DIR_BASE := .. \\n</code># will evaluate to ..<br>GOOD: <code>DIR_BASE := ..\\n</code># will evaluate to ..<br>So the value starts right after assingment symbol and ends at newline or comment hash. </p>
<h4 id="dont-set-variables-with-the-environment">Dont set variables with the environment</h4>
<p>The -e switch will push the whole environment in and who knows whats in there.<br>Setting variables after the the make command will isolate and document what you are trying to do.<br>BAD: <code>USE_THINGY=1 make -e</code># set through environment<br>GOOD: <code>make USE_THINGY=1</code># set by make<br>Unsetting variables on the command line<br>GOOD: <code>make USE_THINGY=</code></p>
